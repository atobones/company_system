{% extends "base.html" %}
{% block title %}–õ–∏—Ü–µ–Ω–∑–∏–∏{% endblock %}
{% block content %}

{% if is_admin %}
<div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
  <a href="{% url 'add_license' %}" class="btn btn-report">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é</a>
  <button id="toggleDeleteMode" class="btn btn-delete" style="display: inline-block;">üóë –£–¥–∞–ª–∏—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–∏</button>
</div>
{% endif %}

<h2 style="margin-top: 25px;">–°–ø–∏—Å–æ–∫ –ª–∏—Ü–µ–Ω–∑–∏–π</h2>

<input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É..." style="margin-bottom: 20px; padding: 8px; width: 300px;">

<form method="POST" action="{% url 'bulk_delete_licenses' %}">
  {% csrf_token %}
  <ul id="licenseList">
    {% for license in licenses %}
    <li class="list-item license-entry">
      <div style="display: flex; align-items: center; gap: 10px;">
        {% if is_admin %}
        <input type="checkbox" name="license_ids" value="{{ license.id }}" class="delete-checkbox" style="display: none;">
        {% endif %}
        <div>
          <strong>üöó {{ license.registration_number }}</strong>
          <div class="text-muted" style="font-size: 13px;">üìÖ {{ license.created_at|date:"d.m.Y H:i" }} ‚Ä¢ {{ license.file.name|cut:"licenses/" }}</div>
        </div>
      </div>
      <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
        <a href="{{ license.file.url }}" target="_blank" class="btn btn-view">üëÅ –û—Ç–∫—Ä—ã—Ç—å</a>
        <a href="{{ license.file.url }}" download class="btn btn-download">‚¨á –°–∫–∞—á–∞—Ç—å</a>
      </div>
    </li>
    {% endfor %}
  </ul>

  {% if is_admin %}
  <div id="confirmDeleteBox" style="display: none; margin-top: 15px;">
    <button type="submit" class="btn btn-delete">‚úÖ –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
    <button type="button" id="cancelDelete" class="btn btn-back">‚ùå –û—Ç–º–µ–Ω–∞</button>
  </div>
  {% endif %}
</form>

<script>
  const toggleBtn = document.getElementById('toggleDeleteMode');
  const confirmBox = document.getElementById('confirmDeleteBox');
  const cancelBtn = document.getElementById('cancelDelete');
  const checkboxes = document.querySelectorAll('.delete-checkbox');

  if (toggleBtn) {
    toggleBtn.addEventListener('click', () => {
      checkboxes.forEach(cb => cb.style.display = 'inline-block');
      confirmBox.style.display = 'block';
      toggleBtn.style.display = 'none';
    });
  }

  if (cancelBtn) {
    cancelBtn.addEventListener('click', () => {
      checkboxes.forEach(cb => {
        cb.checked = false;
        cb.style.display = 'none';
      });
      confirmBox.style.display = 'none';
      toggleBtn.style.display = 'inline-block';
    });
  }

  const searchInput = document.getElementById('searchInput');
  const licenseItems = document.getElementById('licenseList').getElementsByTagName('li');

  searchInput.addEventListener('input', function () {
    const query = this.value.toLowerCase();
    for (let item of licenseItems) {
      const text = item.textContent.toLowerCase();
      item.style.display = text.includes(query) ? '' : 'none';
    }
  });
</script>

{% endblock %}
